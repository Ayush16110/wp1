<html><head><title>backend::database_routines</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="black with blue on white" type="text/css" href="../_black_with_blue_on_white.css" media="all" >
<link rel="alternate stylesheet" title="black with magenta on white" type="text/css" href="../_black_with_magenta_on_white.css" media="all" >
<link rel="alternate stylesheet" title="black with cyan on white" type="text/css" href="../_black_with_cyan_on_white.css" media="all" >
<link rel="alternate stylesheet" title="white with purple on black" type="text/css" href="../_white_with_purple_on_black.css" media="all" >
<link rel="alternate stylesheet" title="white with navy blue on black" type="text/css" href="../_white_with_navy_blue_on_black.css" media="all" >
<link rel="alternate stylesheet" title="grey with green on black" type="text/css" href="../_grey_with_green_on_black.css" media="all" >
<link rel="alternate stylesheet" title="white with green on grey" type="text/css" href="../_white_with_green_on_grey.css" media="all" >
<link rel="alternate stylesheet" title="black with green on grey" type="text/css" href="../_black_with_green_on_grey.css" media="all" >
<link rel="alternate stylesheet" title="grey with green on white" type="text/css" href="../_grey_with_green_on_white.css" media="all" >
<link rel="alternate stylesheet" title="indexless black with blue on white" type="text/css" href="../_indexless_black_with_blue_on_white.css" media="all" >
<link rel="alternate stylesheet" title="indexless white with purple on black" type="text/css" href="../_indexless_white_with_purple_on_black.css" media="all" >
<link rel="alternate stylesheet" title="indexless white with green on grey" type="text/css" href="../_indexless_white_with_green_on_grey.css" media="all" >
<link rel="alternate stylesheet" title="indexless grey with green on white" type="text/css" href="../_indexless_grey_with_green_on_white.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010000 at Sat Feb 13 23:41:17 2010 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Routines to connect,
query,
and commit to the database</p>

<p>Note that autocommit is turned off,
so <code>db_commit()</code> must be called to finish each transaction.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<dl>
<dt><a name="Standard_parameters:"
>Standard parameters:</a></dt>

<dd>
<dl>
<dt><a name="TIMESTAMP"
>TIMESTAMP</a></dt>

<dd>
<p>Current time</p>

<dt><a name="PROJECT"
>PROJECT</a></dt>

<dd>
<p>The name of a rated project</p>

<dt><a name="NAMESPACE"
>NAMESPACE</a></dt>

<dd>
<p>The namespace of ARTICLE</p>

<dt><a name="ARTICLE"
>ARTICLE</a></dt>

<dd>
<p>The name of an article</p>

<dt><a name="RTYPE"
>RTYPE</a></dt>

<dd>
<p>Either &#39;quality&#39; or &#39;importance&#39;</p>

<dt><a name="RATING"
>RATING</a></dt>

<dd>
<p>A quality or importance rating name,
e.g.
Start-Class,
Top-Class</p>

<dt><a name="REV_TIMESTAMP"
>REV_TIMESTAMP</a></dt>

<dd>
<p>A timestamp used to describe a particular revision of an article; used in conjunction with the ARTICLE parameter</p>
</dd>
</dl>

<dt><a name="update_article_data(TIMESTAMP,_PROJECT,_NAMESPACE,_ARTICLE,_RTYPE,_RATING,_REV_TIMESTAMP,_PREVIOUS_RATING)"
><b>update_article_data</b>(TIMESTAMP,
PROJECT,
NAMESPACE,
ARTICLE,
RTYPE,
RATING,
REV_TIMESTAMP,
PREVIOUS_RATING)</a></dt>

<dd>
<p>Top-level routine for updating data for a single article.
Updates the <i>ratings</i> table and <i>logging</i> table.</p>

<p>Parameters:</p>

<dl>
<dt><a name="PREVIOUS_RATING"
>PREVIOUS_RATING</a></dt>

<dd>
<p>Previous rating value,
used for <i>logging</i></p>
</dd>
</dl>

<dt><a name="update_article_moved(TIMESTAMP,_OLD_NAMESPACE,_OLD_ARTICLE,_NEW_NAMESPACE,_NEW_TITLE,_REV_TIMESTAMP)"
><b>update_article_moved</b>(TIMESTAMP,
OLD_NAMESPACE,
OLD_ARTICLE,
NEW_NAMESPACE,
NEW_TITLE,
REV_TIMESTAMP)</a></dt>

<dd>
<p>Top-level routine for logging that an article has been moved.
Updates the <i>moves</i> table and the &#60;logging&#62; table;</p>

<p>Does not update any data for the for new name,
only updates for old name.</p>

<dt><a name="update_category_data_(PROJECT,_RATING,_RTYPE,_CATEGORY,_RANKING,_REPLACEMENT)"
><b>update_category_data</b> (PROJECT,
RATING,
RTYPE,
CATEGORY,
RANKING,
REPLACEMENT)</a></dt>

<dd>
<p>Update information about a rating for a project</p>

<dl>
<dt><a name="CATEGORY"
>CATEGORY</a></dt>

<dd>
<p>The wikipedia category listing these articles.
e.g.
<code>Category:B-Class mathematics articles</code></p>

<dt><a name="RANKING"
>RANKING</a></dt>

<dd>
<p>A numeric sort ranking used to sort tables</p>

<dt><a name="REPLACEMENT"
>REPLACEMENT</a></dt>

<dd>
<p>A standard rating (e.g.
B-Class) used to replcae this rating in global statistics</p>
</dd>
</dl>

<dt><a name="update_article_rating_data(PROJECT,_ARTICLE,_RTYPE,_RATING,_REV_TIMESTAMP)"
><b>update_article_rating_data</b>(PROJECT,
ARTICLE,
RTYPE,
RATING,
REV_TIMESTAMP)</a></dt>

<dd>
<p>Update <i>ratings</i> table for a single article</p>

<dt><a name="update_articles_table(PROJECT)"
><b>update_articles_table</b>(PROJECT)</a></dt>

<dd>
<p>Update <i>articles</i> table,
which stores the highest quality and importance assigned to an article.
Must be run after updating a project,
to keep database coherent.</p>

<dt><a name="update_project(PROJECT,_TIMESTAMP,_WIKIPAGE,_PARENT,_SHORTNAME)"
><b>update_project</b>(PROJECT,
TIMESTAMP,
WIKIPAGE,
PARENT,
SHORTNAME)</a></dt>

<dd>
<p>Update the project table with data for PROJECT</p>

<p>Parameters:</p>

<dl>
<dt><a name="TIMESTAMP"
>TIMESTAMP</a></dt>

<dd>
<p>when PROJECT was last updated</p>

<dt><a name="WIKIPAGE"
>WIKIPAGE</a></dt>

<dd>
<p>wikipedia homepage for PROJECT</p>

<dt><a name="PARENT"
>PARENT</a></dt>

<dd>
<p>Parent project,
or undef</p>

<dt><a name="SHORTNAME"
>SHORTNAME</a></dt>

<dd>
<p>Abbreviated name to display for PROJECT</p>
</dd>
</dl>

<dt><a name="project_exists(PROJECT)"
><b>project_exists</b>(PROJECT)</a></dt>

<dd>
<p>Returns true if PROJECT exists in the <i>projects</i> table,
false otherwise</p>

<dt><a name="get_project_ratings(PROJECT,_TYPE)"
><b>get_project_ratings</b>(PROJECT,
TYPE)</a></dt>

<dd>
<p>Fetch assessments of TYPE for PROJECT.</p>

<p>Returns a hash: <code>namespace:article</code> =&#62; <code>rating</code></p>

<dt><a name="db_commit()"
><b>db_commit</b>()</a></dt>

<dd>
<p>Commit current DB transaction</p>

<dt><a name="db_rollback()"
><b>db_rollback</b>()</a></dt>

<dd>
<p>Rollback current DB transaction</p>

<dt><a name="db_cleanup_project(PROJECT)"
><b>db_cleanup_project</b>(PROJECT)</a></dt>

<dd>
<p>Deletes data forr articles that were once assessed but aren&#39;t anymore.
Also gets rid of NULL values in <i>ratings</i> table.</p>

<p>First,
delete rows from <i>ratings</i> table for PROJECT where quality and importance are both nonexistent or unrecognized classes.
Then replace any NULL <i>ratings</i> quality or importance values with a sentinel value.</p>

<dt><a name="db_connect()"
><b>db_connect</b>()</a></dt>

<dd>
<p>Connect to DB.
Runs automatically when file is loaded.</p>

<p>Parameters:</p>

<dl>
<dt><a name="OPTS"
>OPTS</a></dt>

<dd>
<p>The options hash returned by read_conf()</p>
</dd>
</dl>

<dt><a name="db_list_projects()"
><b>db_list_projects</b>()</a></dt>

<dd>
<p>Returns an array ref containing all projects names in <i>projects</i> table</p>

<dt><a name="db_get_project_details()"
><b>db_get_project_details</b>()</a></dt>

<dd>
<p>Returns a hash reference:</p>

<pre> PROJECT =&#62; { &#39;count&#39; =&#62; COUNT, 
              &#39;timestamp&#39; =&#62; TIMESTAMP }</pre>

<dt><a name="db_get_project_timestamp()"
><b>db_get_project_timestamp</b>()</a></dt>

<dd>
<p>Returns the last time PROJECT was updated, or undef if project was never updated.</p>

<dt><a name="update_review_data(TIMESTAMP,_ARTICLE,_RATING,_REV_TIMESTAMP,_PREVIOUS_RATING)"
><b>update_review_data</b>(TIMESTAMP, ARTICLE, RATING, REV_TIMESTAMP, PREVIOUS_RATING)</a></dt>

<dd>
<p>Update review status (FA, FL, GA) for ARTICLE.</p>

<dt><a name="remove_review_data(ARTICLE,_RATING,_PREVIOUS_RATING)"
><b>remove_review_data</b>(ARTICLE, RATING, PREVIOUS_RATING)</a></dt>

<dd>
<p>Removes ARTICLE from <i>reviews</i> table. Asserts RATING=&#39;None&#39;.</p>

<dt><a name="get_review_data(RATING)"
><b>get_review_data</b>(RATING)</a></dt>

<dd>
<p>Fetch articles with review status RATING</p>

<p>Returns a hash ref ARTICLE =&#62; RATING</p>

<dt><a name="db_get_release_data()"
><b>db_get_release_data</b>()</a></dt>

<dd>
<p>Get data about released articles from <i>releases</i></p>

<p>Returns a hash reference:</p>

<pre> PROJECT =&#62; { &#39;0.5:category&#39; =&#62; CAT,
              &#39;0.5:timestamp&#39; =&#62; TIMESTAMP }</pre>

<dt><a name="db_set_release_data(ARTICLE,_RELEASE,_CATEGORY,_REV_TIMESTAMP)"
><b>db_set_release_data</b>(ARTICLE, RELEASE, CATEGORY, REV_TIMESTAMP)</a></dt>

<dd>
<p>&#60;description&#62;</p>

<p>Parameters:</p>

<dl>
<dt><a name="RELEASE"
>RELEASE</a></dt>

<dd>
<p>The name of the relase. Only <code>0.5</code> is supported.</p>

<dt><a name="CATEGORY"
>CATEGORY</a></dt>

<dd>
<p>The release category - <code>Arts</code> etc.</p>
</dd>
</dl>

<dt><a name="db_cleanup_releases()"
><b>db_cleanup_releases</b>()</a></dt>

<dd>
<p>Remove articles from <i>releases</i> table that are no longer included in any release versions.</p>

<dt><a name="db_lock(LOCKNAME)"
><b>db_lock</b>(LOCKNAME)</a></dt>

<dd>
<p>Gets an advisory lock from the database. Does not block.</p>

<p>Returns true if the lock wa acquired, false otherwise.</p>

<dt><a name="db_unlock(LOCKNAME)"
><b>db_unlock</b>(LOCKNAME)</a></dt>

<dd>
<p>Release an advisory lock</p>

<dt><a name="update_project_scores(PROJECT)"
><b>update_project_scores</b>(PROJECT)</a></dt>

<dd>
<p>Update the release version scores for articles in a project. Requires that the icount field in the projects table is accurate.</p>

<dt><a name="database_handle()"
><b>database_handle</b>()</a></dt>

<dd>
<p>Return the Perl DBI database handle</p>
</dd>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
